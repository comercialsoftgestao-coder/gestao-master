<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GESTÃO MASTER - Administração Imobiliária</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #fdfdfd; user-select: none; }
        
        /* Padrão de Casinhas no Fundo - Azul Profissional */
        .bg-pattern-houses {
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e0f2fe' fill-opacity='0.6'%3E%3Cpath d='M40 10 L55 25 L55 45 L25 45 L25 25 Z' /%3E%3Cpath d='M10 50 L20 60 L20 75 L0 75 L0 60 Z' opacity='0.5'/%3E%3Cpath d='M70 50 L80 60 L80 75 L60 75 L60 60 Z' opacity='0.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f0f9ff; }
        ::-webkit-scrollbar-thumb { background: #7dd3fc; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #0c4a6e; }
        
        .animate-fade-in { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        /* Estilos de Impressão */
        .print-area { font-family: 'Times New Roman', serif; line-height: 1.6; }
        .print-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-family: sans-serif; font-size: 12px; }
        .print-table th, .print-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .print-table th { background-color: #f2f2f2; font-weight: bold; }
        .contract-header { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 20px; text-transform: uppercase; }
        .contract-body { text-align: justify; margin-bottom: 30px; font-size: 14px; }
        .contract-clause { margin-bottom: 10px; }
        .contract-clause strong { font-weight: bold; }
        .recibo-box { border: 2px dashed #1e3a8a; padding: 30px; margin: 20px 0; background: #fff; border-radius: 10px; }

        @media print {
            body * { visibility: hidden; }
            #print-area-container, #print-area-container * { visibility: visible; }
            #print-area-container { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 40px; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-pattern-houses text-slate-700">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- TOAST ---
        const Toast = ({ message, type, show, onClose }) => {
            if (!show) return null;
            const bgClass = type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-green-500' : 'bg-blue-800');
            return (
                <div className={`fixed top-4 right-4 ${bgClass} text-white px-6 py-4 rounded-2xl shadow-xl z-[60] flex items-center gap-3 animate-fade-in border-4 border-white`}>
                    <i className={type === 'error' ? "ph ph-warning-circle text-2xl" : "ph ph-check-circle text-2xl"}></i>
                    <span className="font-bold">{message}</span>
                    <button onClick={onClose} className="opacity-75 hover:opacity-100 ml-4"><i className="ph ph-x text-lg"></i></button>
                </div>
            );
        };

        // --- CHART ---
        const ChartComponent = ({ type, data, options }) => {
            const chartRef = useRef(null);
            const canvasRef = useRef(null);
            useEffect(() => {
                if (canvasRef.current) {
                    if (chartRef.current) chartRef.current.destroy();
                    chartRef.current = new Chart(canvasRef.current, { type, data, options: { responsive: true, maintainAspectRatio: false, ...options } });
                }
                return () => { if (chartRef.current) chartRef.current.destroy(); };
            }, [data, type, options]);
            return <div className="relative h-full w-full"><canvas ref={canvasRef}></canvas></div>;
        };

        // --- LOGO ---
        const BrandLogo = ({ className = "" }) => (
            <div className={`flex items-center gap-3 ${className}`}>
                <div className="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-blue-900 shadow-md border-2 border-blue-100 transform -rotate-3">
                    <i className="ph-fill ph-house text-3xl"></i>
                </div>
                <div>
                    <h1 className="text-2xl font-extrabold tracking-tight text-white drop-shadow-sm leading-none uppercase">GESTÃO<span className="text-blue-200"> MASTER</span></h1>
                    <p className="text-[10px] text-white/90 font-bold uppercase tracking-widest mt-1">Adm. de Imóveis</p>
                </div>
            </div>
        );

        const Icon = ({ name, size = 20, className = "", weight = "regular" }) => 
            <i className={`ph ph-${name} ${className}`} style={{ fontSize: size, fontWeight: weight === 'bold' ? 700 : 400 }}></i>;

        const Card = ({ children, className = "", onClick }) => 
            <div onClick={onClick} className={`bg-white rounded-2xl shadow-sm border border-slate-100 ${className}`}>{children}</div>;

        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value || 0);

        // --- TELA DE LOGIN ---
        const LoginScreen = ({ onLogin }) => {
            const [user, setUser] = useState('');
            const [pass, setPass] = useState('');
            const [remember, setRemember] = useState(false);
            
            useEffect(() => {
                const savedLogin = localStorage.getItem('rentmaster_login_remember');
                if (savedLogin) {
                    const { user: savedUser, pass: savedPass } = JSON.parse(savedLogin);
                    setUser(savedUser);
                    setPass(savedPass);
                    setRemember(true);
                }
            }, []);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (remember) {
                    localStorage.setItem('rentmaster_login_remember', JSON.stringify({ user, pass }));
                } else {
                    localStorage.removeItem('rentmaster_login_remember');
                }
                onLogin(user, pass);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-blue-50 relative overflow-hidden bg-pattern-houses">
                    <div className="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-sm z-10 border-4 border-blue-100 animate-fade-in mx-4">
                        <div className="flex justify-center mb-8">
                            <div className="flex flex-col items-center gap-2">
                                <div className="w-16 h-16 bg-blue-900 rounded-full flex items-center justify-center text-white shadow-lg border-4 border-white">
                                    <i className="ph-fill ph-house text-4xl"></i>
                                </div>
                                <h1 className="text-3xl font-extrabold text-slate-800 uppercase tracking-tighter">GESTÃO <span className="text-blue-900">MASTER</span></h1>
                            </div>
                        </div>
                        <h2 className="text-sm font-bold text-center text-slate-400 mb-6 uppercase tracking-wider">Acesso Seguro</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div className="relative">
                                <span className="absolute left-3 top-3 text-blue-300"><Icon name="user" weight="bold"/></span>
                                <input type="text" className="w-full p-3 pl-10 bg-slate-50 border-2 border-slate-100 rounded-xl outline-none focus:border-blue-400 focus:bg-white transition-all font-bold text-slate-600" value={user} onChange={(e) => setUser(e.target.value)} placeholder="Usuário" />
                            </div>
                            <div className="relative">
                                <span className="absolute left-3 top-3 text-blue-300"><Icon name="lock" weight="bold"/></span>
                                <input type="password" className="w-full p-3 pl-10 bg-slate-50 border-2 border-slate-100 rounded-xl outline-none focus:border-blue-400 focus:bg-white transition-all font-bold text-slate-600" value={pass} onChange={(e) => setPass(e.target.value)} placeholder="Senha" />
                            </div>
                            
                            <div className="flex items-center">
                                <input id="remember-me" type="checkbox" className="w-5 h-5 text-blue-900 bg-gray-100 border-gray-300 rounded focus:ring-blue-900" checked={remember} onChange={(e) => setRemember(e.target.checked)} />
                                <label htmlFor="remember-me" className="ml-2 text-sm font-bold text-slate-500 cursor-pointer">Lembrar meus dados</label>
                            </div>

                            <button type="submit" className="w-full bg-gradient-to-r from-blue-800 to-blue-950 hover:from-blue-900 hover:to-black text-white font-extrabold py-4 rounded-xl flex justify-center items-center gap-2 shadow-lg shadow-blue-200 transform hover:scale-[1.02] transition-all">
                                <span>ENTRAR NO SISTEMA</span> <Icon name="arrow-right" weight="bold" />
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [appState, setAppState] = useState('login'); 
            
            // CONFIGURAÇÕES E CREDENCIAIS
            const [credentials, setCredentials] = useState(() => {
                const saved = localStorage.getItem('rentmaster_credentials');
                return saved ? JSON.parse(saved) : { user: 'admin', pass: 'admin' };
            });

            const [userData, setUserData] = useState(() => {
                const saved = localStorage.getItem('rentmaster_userdata');
                return saved ? JSON.parse(saved) : { name: 'Proprietário Master', email: 'contato@gestaomaster.com', phone: '', document: '' };
            });

            // ESTADOS DE DADOS
            const [properties, setProperties] = useState([]);
            const [tenants, setTenants] = useState([]);
            const [contracts, setContracts] = useState([]);
            const [financial, setFinancial] = useState([]);
            
            const [loading, setLoading] = useState(true);

            // UI
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            
            // FORMS
            const [propertyForm, setPropertyForm] = useState({ nickname: '', address: '', type: 'Casa', iptu_id: '', energy_code: '', water_code: '', description: '', status: 'Vago', base_rent: '', legal_status: 'Regular', legal_notes: '', doc_registration: false, doc_deed: false, doc_iptu: false });
            const [tenantForm, setTenantForm] = useState({ name: '', cpf: '', email: '', phone: '', status: 'Ativo', documents_checked: false });
            const [contractForm, setContractForm] = useState({ propertyId: '', tenantId: '', start_date: '', end_date: '', rent_value: '', deposit_value: '', payment_day: '5', status: 'Ativo', index_adjustment: 'IPCA', fileName: '' });
            const [financeForm, setFinanceForm] = useState({ type: 'Receita', category: 'Aluguel', description: '', value: '', date: '', status: 'Pendente', propertyId: '' });
            const [configPasswordForm, setConfigPasswordForm] = useState({ current: '', newPass: '', confirm: '' });

            const [toast, setToast] = useState({ show: false, message: '', type: 'info' });
            const showToast = (msg, type = 'info') => { setToast({ show: true, message: msg, type }); setTimeout(() => setToast({ show: false, message: '', type: 'info' }), 3000); };

            // CARREGAR DADOS
            useEffect(() => {
                if (appState === 'authenticated') {
                    const load = (key, setFn, mock) => {
                        const data = localStorage.getItem(`rentmaster_${key}`);
                        if (data) setFn(JSON.parse(data));
                        else setFn(mock);
                    };

                    load('properties', setProperties, [
                        { id: 1, nickname: 'Casa da Esquina', address: 'Rua das Flores, 123', type: 'Casa', iptu_id: '123.456.789', status: 'Alugado', base_rent: 2500, description: '3 Quartos, 1 Suíte', legal_status: 'Regular', doc_registration: true, doc_deed: true, doc_iptu: true },
                        { id: 2, nickname: 'Apto Centro', address: 'Av. Paulista, 900', type: 'Apartamento', iptu_id: '987.654.321', status: 'Vago', base_rent: 3200, description: 'Mobiliado', legal_status: 'Espólio', legal_notes: 'Inventário em andamento na 2ª Vara Cível', doc_registration: false, doc_deed: true, doc_iptu: false }
                    ]);
                    load('tenants', setTenants, [
                        { id: 1, name: 'João Silva', cpf: '123.456.789-00', phone: '11999999999', email: 'joao@email.com', status: 'Ativo', documents_checked: true }
                    ]);
                    load('contracts', setContracts, [
                        { id: 1, propertyId: 1, tenantId: 1, start_date: '2023-01-10', end_date: '2025-01-10', rent_value: 2500, deposit_value: 7500, payment_day: '10', status: 'Ativo', index_adjustment: 'IPCA', fileName: 'contrato_assinado.pdf' }
                    ]);
                    load('financial', setFinancial, [
                        { id: 1, type: 'Receita', category: 'Aluguel', description: 'Aluguel Casa Esquina - Dez', value: 2500, date: '2023-12-10', status: 'Pago', propertyId: 1 }
                    ]);

                    setLoading(false);
                }
            }, [appState]);

            // SALVAR DADOS
            useEffect(() => {
                if (!loading && appState === 'authenticated') {
                    localStorage.setItem('rentmaster_properties', JSON.stringify(properties));
                    localStorage.setItem('rentmaster_tenants', JSON.stringify(tenants));
                    localStorage.setItem('rentmaster_contracts', JSON.stringify(contracts));
                    localStorage.setItem('rentmaster_financial', JSON.stringify(financial));
                    localStorage.setItem('rentmaster_userdata', JSON.stringify(userData));
                    localStorage.setItem('rentmaster_credentials', JSON.stringify(credentials));
                }
            }, [properties, tenants, contracts, financial, userData, credentials, loading, appState]);

            const handleLogin = (u, p) => {
                if (u === credentials.user && p === credentials.pass) setAppState('authenticated');
                else showToast('Credenciais inválidas', 'error');
            };

            const handleSaveConfig = (e) => {
                e.preventDefault();
                showToast('Dados cadastrais atualizados!', 'success');
            };

            const handleChangePassword = (e) => {
                e.preventDefault();
                if (configPasswordForm.current !== credentials.pass) {
                    showToast('Senha atual incorreta.', 'error');
                    return;
                }
                if (configPasswordForm.newPass !== configPasswordForm.confirm) {
                    showToast('As novas senhas não conferem.', 'error');
                    return;
                }
                if (configPasswordForm.newPass.length < 4) {
                    showToast('A senha deve ter pelo menos 4 caracteres.', 'error');
                    return;
                }
                setCredentials({ ...credentials, pass: configPasswordForm.newPass });
                setConfigPasswordForm({ current: '', newPass: '', confirm: '' });
                showToast('Senha alterada com sucesso!', 'success');
            };

            const deleteItem = (id, list, setList) => {
                if(confirm('Tem certeza que deseja excluir?')) {
                    setList(list.filter(i => i.id !== id));
                    showToast('Registro removido.', 'success');
                }
            };

            const openModal = (type, item = null) => {
                setModalType(type);
                setEditingItem(item);
                const today = new Date().toISOString().split('T')[0];

                if (type === 'property') setPropertyForm(item || { nickname: '', address: '', type: 'Casa', iptu_id: '', energy_code: '', water_code: '', description: '', status: 'Vago', base_rent: '', legal_status: 'Regular', legal_notes: '', doc_registration: false, doc_deed: false, doc_iptu: false });
                else if (type === 'tenant') setTenantForm(item || { name: '', cpf: '', email: '', phone: '', status: 'Ativo', documents_checked: false });
                else if (type === 'contract') setContractForm(item || { propertyId: '', tenantId: '', start_date: today, end_date: '', rent_value: '', deposit_value: '', payment_day: '5', status: 'Ativo', index_adjustment: 'IPCA', fileName: '' });
                else if (type === 'finance') setFinanceForm(item || { type: 'Receita', category: 'Aluguel', description: '', value: '', date: today, status: 'Pendente', propertyId: '' });
                
                setIsModalOpen(true);
            };

            const saveItem = (e) => {
                e.preventDefault();
                const id = editingItem ? editingItem.id : Date.now();

                if (modalType === 'property') {
                    const newItem = { ...propertyForm, id, base_rent: parseFloat(propertyForm.base_rent) };
                    setProperties(editingItem ? properties.map(i => i.id === id ? newItem : i) : [...properties, newItem]);
                } else if (modalType === 'tenant') {
                    const newItem = { ...tenantForm, id };
                    setTenants(editingItem ? tenants.map(i => i.id === id ? newItem : i) : [...tenants, newItem]);
                } else if (modalType === 'contract') {
                    const newItem = { ...contractForm, id, rent_value: parseFloat(contractForm.rent_value), deposit_value: parseFloat(contractForm.deposit_value), propertyId: parseInt(contractForm.propertyId), tenantId: parseInt(contractForm.tenantId) };
                    setContracts(editingItem ? contracts.map(i => i.id === id ? newItem : i) : [...contracts, newItem]);
                    if (newItem.status === 'Ativo') {
                        setProperties(properties.map(p => p.id === newItem.propertyId ? { ...p, status: 'Alugado' } : p));
                    }
                } else if (modalType === 'finance') {
                    const newItem = { ...financeForm, id, value: parseFloat(financeForm.value), propertyId: parseInt(financeForm.propertyId) };
                    setFinancial(editingItem ? financial.map(i => i.id === id ? newItem : i) : [...financial, newItem]);
                }

                setIsModalOpen(false);
                showToast('Salvo com sucesso!', 'success');
            };

            const generateReportCSV = (type) => {
                let content = "Data,Imovel,Descricao,Categoria,Valor,Status\n";
                if (type === 'finance') {
                    financial.forEach(f => {
                        const prop = properties.find(p => p.id === f.propertyId);
                        content += `${f.date},${prop?.nickname || 'Geral'},${f.description},${f.category},${f.value},${f.status}\n`;
                    });
                }
                const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `Relatorio_${type}.csv`;
                link.click();
                showToast('Relatório exportado!', 'success');
            };

            const stats = useMemo(() => {
                const totalIncome = financial.filter(f => f.type === 'Receita' && f.status === 'Pago').reduce((a, b) => a + (b.value || 0), 0);
                const totalExpense = financial.filter(f => f.type === 'Despesa' && f.status === 'Pago').reduce((a, b) => a + (b.value || 0), 0);
                const occupied = properties.filter(p => p.status === 'Alugado').length;
                const activeValue = contracts.filter(c => c.status === 'Ativo').reduce((a,b) => a + (b.rent_value || 0), 0);
                const riskLegal = properties.filter(p => ['Judicial', 'Penhora', 'Dívida Ativa'].includes(p.legal_status)).length;
                const pendingDocs = properties.filter(p => !p.doc_registration || !p.doc_deed || !p.doc_iptu).length;
                return { totalIncome, totalExpense, balance: totalIncome - totalExpense, occupied, activeValue, riskLegal, pendingDocs, totalProperties: properties.length };
            }, [financial, properties, contracts]);

            if (appState === 'login') return <LoginScreen onLogin={handleLogin} />;

            const menuItems = [
                { id: 'dashboard', label: 'Visão Geral', icon: 'chart-pie-slice' },
                { id: 'situation', label: 'Situação Legal', icon: 'gavel' },
                { id: 'properties', label: 'Meus Imóveis', icon: 'house' },
                { id: 'tenants', label: 'Inquilinos', icon: 'users' },
                { id: 'contracts', label: 'Contratos', icon: 'file-text' },
                { id: 'finance', label: 'Financeiro', icon: 'currency-dollar' },
                { id: 'reports', label: 'Relatórios', icon: 'scroll' }, 
                { id: 'config', label: 'Configurações', icon: 'gear' }, 
            ];

            return (
                <div className="flex h-screen overflow-hidden bg-pattern-houses text-slate-700 font-bold">
                    <Toast {...toast} onClose={() => setToast({...toast, show: false})} />
                    
                    <aside className={`fixed inset-y-0 left-0 z-30 w-64 bg-blue-900 text-white flex flex-col transition-transform duration-300 md:relative md:translate-x-0 ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} shadow-2xl`}>
                        <div className="p-6 border-b border-blue-800/30">
                            <BrandLogo />
                        </div>
                        <nav className="flex-1 overflow-y-auto py-6 px-4 space-y-2">
                            {menuItems.map(item => (
                                <button key={item.id} onClick={() => { setActiveTab(item.id); setIsMobileMenuOpen(false); }}
                                    className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all font-bold text-sm ${activeTab === item.id ? 'bg-white text-blue-900 shadow-lg translate-x-1' : 'hover:bg-blue-800 hover:translate-x-1 text-white/90'}`}>
                                    <Icon name={item.icon} size={22} weight={activeTab === item.id ? 'fill' : 'bold'} />
                                    {item.label}
                                </button>
                            ))}
                        </nav>
                        <div className="p-6 bg-blue-950 backdrop-blur-sm">
                            <div className="flex items-center gap-3 text-left">
                                <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center font-bold text-blue-900 text-sm shadow-md border-2 border-blue-200 uppercase">
                                    {userData.name.charAt(0)}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <p className="text-sm font-bold text-white truncate text-left">{userData.name}</p>
                                    <p className="text-[10px] text-blue-200 uppercase tracking-wide truncate text-left">Admin Master</p>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <main className="flex-1 flex flex-col min-w-0 overflow-hidden relative">
                        <header className="h-20 bg-white/80 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-4 md:px-8 shadow-sm z-10 sticky top-0">
                            <div className="flex items-center gap-4 text-left">
                                <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="md:hidden text-slate-600 p-2 hover:bg-slate-100 rounded-lg"><Icon name="list" size={28} /></button>
                                <div className="text-left">
                                    <h2 className="text-2xl font-extrabold text-slate-800 tracking-tight uppercase tracking-tighter text-left">{menuItems.find(i => i.id === activeTab)?.label}</h2>
                                    <p className="text-xs text-slate-400 font-bold text-left">{new Date().toLocaleDateString('pt-BR', {day: 'numeric', month: 'long', year: 'numeric'})}</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-xs text-slate-500 font-bold hidden md:block">Bem-vindo, {userData.name.split(' ')[0]}</span>
                                <button onClick={() => setAppState('login')} className="p-2 bg-slate-100 rounded-full text-slate-500 hover:text-red-500 transition-colors shadow-sm border"><Icon name="sign-out" size={20} weight="bold"/></button>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 md:p-8">
                            
                            {/* DASHBOARD */}
                            {activeTab === 'dashboard' && (
                                <div className="space-y-8 animate-fade-in text-left">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                        <Card className="p-6 bg-gradient-to-br from-blue-800 to-blue-950 text-white border-none card-hover">
                                            <p className="text-xs text-blue-100 uppercase font-bold tracking-wider mb-2">Previsão Contratada</p>
                                            <h3 className="text-3xl font-extrabold">{formatCurrency(stats.activeValue)}</h3>
                                        </Card>
                                        <Card className="p-6 bg-gradient-to-br from-green-600 to-green-700 text-white border-none card-hover">
                                            <p className="text-xs text-green-100 uppercase font-bold tracking-wider mb-2">Líquido do Mês</p>
                                            <h3 className="text-3xl font-extrabold">{formatCurrency(stats.balance)}</h3>
                                        </Card>
                                        <Card className="p-6 bg-white border-2 border-slate-100 card-hover">
                                            <div className="flex justify-between items-start text-left">
                                                <div>
                                                    <p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-1">Ocupação</p>
                                                    <h3 className="text-3xl font-extrabold text-slate-800">{stats.occupied} <span className="text-lg text-slate-400">/ {properties.length}</span></h3>
                                                </div>
                                                <div className="p-2 bg-blue-100 text-blue-900 rounded-lg"><Icon name="house-line" weight="fill" size={24}/></div>
                                            </div>
                                        </Card>
                                        <Card className="p-6 bg-white border-2 border-slate-100 card-hover text-left">
                                            <p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-1 text-left">Situação Crítica</p>
                                            <h3 className="text-3xl font-extrabold text-red-500 text-left">{stats.riskLegal}</h3>
                                        </Card>
                                    </div>

                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 text-left">
                                        {/* Rendimento Total */}
                                        <Card className="p-8 card-hover bg-white border-2 border-blue-50 text-left">
                                            <h3 className="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 uppercase tracking-tighter"><div className="p-2 bg-emerald-100 text-emerald-600 rounded-lg"><Icon name="money" weight="fill"/></div> Rendimento Total do Último Mês</h3>
                                            <div className="space-y-6">
                                                <div className="flex flex-col items-center justify-center py-10 bg-gradient-to-b from-slate-50 to-white rounded-[2.5rem] border border-slate-100 shadow-inner text-center relative overflow-hidden">
                                                    <div className="absolute top-0 left-0 w-full h-1 bg-emerald-500"></div>
                                                    <p className="text-xs font-black text-slate-400 uppercase tracking-widest mb-2 text-center">Receita Líquida Consolidada</p>
                                                    <h2 className="text-6xl font-black text-emerald-600 tracking-tighter text-center">{formatCurrency(stats.balance)}</h2>
                                                    <p className="text-[11px] text-slate-400 mt-4 font-extrabold uppercase tracking-widest bg-white px-4 py-1 rounded-full border shadow-sm text-center">Referência: Atual</p>
                                                </div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="p-5 bg-emerald-50/50 border border-emerald-100 rounded-2xl">
                                                        <p className="text-[10px] font-black text-emerald-700 uppercase tracking-widest mb-1 opacity-70">Entradas</p>
                                                        <p className="text-2xl font-black text-emerald-800">{formatCurrency(stats.totalIncome)}</p>
                                                    </div>
                                                    <div className="p-5 bg-red-50/50 border border-red-100 rounded-2xl">
                                                        <p className="text-[10px] font-black text-red-700 uppercase tracking-widest mb-1 opacity-70">Saídas</p>
                                                        <p className="text-2xl font-black text-red-800">{formatCurrency(stats.totalExpense)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </Card>

                                        <Card className="p-8 card-hover overflow-y-auto max-h-[500px] text-left">
                                            <h3 className="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 uppercase tracking-tighter text-left"><div className="p-2 bg-blue-100 text-blue-900 rounded-lg"><Icon name="bell-ringing" weight="fill"/></div> Alertas do Sistema</h3>
                                            
                                            {/* Alertas Jurídicos Clicável */}
                                            {properties.filter(p => ['Judicial', 'Penhora', 'Dívida Ativa'].includes(p.legal_status)).map(p => (
                                                <div key={`alert-leg-${p.id}`} onClick={() => setActiveTab('situation')} className="mb-4 p-4 bg-red-50 border border-red-100 rounded-xl flex items-center justify-between cursor-pointer hover:bg-red-100 transition-all border-l-8 border-l-red-500 group">
                                                    <div className="text-left">
                                                        <p className="text-sm font-extrabold text-red-800">Risco Jurídico: {p.nickname}</p>
                                                        <p className="text-[10px] text-red-600 font-black uppercase tracking-widest mt-1 group-hover:underline">Clique para gerir processo</p>
                                                    </div>
                                                    <Icon name="warning" className="text-red-500 group-hover:scale-110 transition-transform" size={24} weight="bold"/>
                                                </div>
                                            ))}

                                            {/* Alerta Financeiro Clicável */}
                                            {financial.filter(f => f.status === 'Pendente').map(f => (
                                                <div key={`alert-fin-${f.id}`} onClick={() => setActiveTab('finance')} className="mb-4 p-4 bg-blue-50 border border-blue-100 rounded-xl flex items-center justify-between cursor-pointer hover:bg-blue-100 transition-all border-l-8 border-l-blue-400 group">
                                                    <div className="text-left">
                                                        <p className="text-sm font-extrabold text-slate-800">{f.description}</p>
                                                        <p className="text-[10px] text-blue-500 font-bold uppercase tracking-widest group-hover:underline">Ir para Tesouraria</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="text-sm text-blue-600 font-black">{formatCurrency(f.value)}</p>
                                                    </div>
                                                </div>
                                            ))}
                                            
                                            {/* Alerta de Documentação */}
                                            {tenants.filter(t => !t.documents_checked).map(t => (
                                                <div key={`alert-doc-${t.id}`} onClick={() => setActiveTab('tenants')} className="mb-4 p-4 bg-orange-50 border border-orange-100 rounded-xl flex items-center justify-between cursor-pointer hover:bg-orange-100 transition-all border-l-8 border-l-orange-400 group">
                                                    <div className="text-left">
                                                        <p className="text-sm font-extrabold text-slate-800">Doc. Pendente: {t.name}</p>
                                                        <p className="text-[10px] text-orange-600 font-black uppercase tracking-widest group-hover:underline">Regularizar</p>
                                                    </div>
                                                    <Icon name="file-search" className="text-orange-500 group-hover:scale-110 transition-transform" size={24} weight="bold"/>
                                                </div>
                                            ))}
                                        </Card>
                                    </div>
                                </div>
                            )}

                            {/* SITUAÇÃO LEGAL */}
                            {activeTab === 'situation' && (
                                <div className="space-y-8 animate-fade-in text-left">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 text-left">
                                        <Card className="p-6 border-l-8 border-l-emerald-500 flex items-center justify-between">
                                            <div className="text-left"><p className="text-[10px] font-black uppercase text-slate-400">Regularizados</p><h4 className="text-3xl font-black text-slate-800">{properties.filter(p=>p.legal_status==='Regular').length}</h4></div>
                                            <Icon name="check-circle" size={40} className="text-emerald-500" weight="fill"/>
                                        </Card>
                                        <Card className="p-6 border-l-8 border-l-orange-500 flex items-center justify-between">
                                            <div className="text-left"><p className="text-[10px] font-black uppercase text-slate-400">Doc. Pendente</p><h4 className="text-3xl font-black text-slate-800">{stats.pendingDocs}</h4></div>
                                            <Icon name="file-text" size={40} className="text-orange-500" weight="fill"/>
                                        </Card>
                                        <Card className="p-6 border-l-8 border-l-red-500 flex items-center justify-between">
                                            <div className="text-left"><p className="text-[10px] font-black uppercase text-slate-400">Risco Elevado</p><h4 className="text-3xl font-black text-slate-800">{stats.riskLegal}</h4></div>
                                            <Icon name="warning-diamond" size={40} className="text-red-500" weight="fill"/>
                                        </Card>
                                        <Card className="p-6 border-l-8 border-l-blue-900 flex items-center justify-between">
                                            <div className="text-left"><p className="text-[10px] font-black uppercase text-slate-400">Total Carteira</p><h4 className="text-3xl font-black text-slate-800">{stats.totalProperties}</h4></div>
                                            <Icon name="buildings" size={40} className="text-blue-900" weight="fill"/>
                                        </Card>
                                    </div>

                                    <div className="space-y-12">
                                        {['Regular', 'Espólio', 'Inventário em Trâmite', 'Nome de Parente', 'Usucapião', 'Financiado', 'Contrato de Gaveta', 'Judicial', 'Pendente Habite-se', 'Dívida Ativa / Penhora'].map(status => {
                                            const props = properties.filter(p => (p.legal_status || 'Regular') === status);
                                            if (props.length === 0) return null;
                                            return (
                                                <div key={status} className="text-left">
                                                    <h3 className="font-extrabold text-2xl text-blue-900 mb-6 flex items-center gap-2 uppercase tracking-tighter"><Icon name="folder-simple-lock" weight="bold"/> {status}</h3>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        {props.map(p => (
                                                            <Card key={p.id} className="p-8 card-hover border-2 border-slate-100 text-left">
                                                                <div className="flex justify-between items-start text-left">
                                                                    <h4 className="font-black text-xl text-slate-800 mb-1">{p.nickname}</h4>
                                                                    <Icon name="pencil-simple" className="text-slate-300 hover:text-blue-900 cursor-pointer" weight="bold" onClick={() => openModal('property', p)}/>
                                                                </div>
                                                                <p className="text-xs font-bold text-slate-400 mb-4">{p.address}</p>
                                                                <div className="space-y-2 mb-6 bg-slate-50 p-4 rounded-2xl border text-xs font-black uppercase tracking-widest text-left">
                                                                    <div className="flex justify-between text-left"><span>Matrícula</span>{p.doc_registration ? <Icon name="check-circle" className="text-emerald-500" weight="fill"/> : <Icon name="x-circle" className="text-red-400" weight="fill"/>}</div>
                                                                    <div className="flex justify-between text-left"><span>Escritura</span>{p.doc_deed ? <Icon name="check-circle" className="text-emerald-500" weight="fill"/> : <Icon name="x-circle" className="text-red-400" weight="fill"/>}</div>
                                                                    <div className="flex justify-between text-left"><span>IPTU em dia</span>{p.doc_iptu ? <Icon name="check-circle" className="text-emerald-500" weight="fill"/> : <Icon name="x-circle" className="text-red-400" weight="fill"/>}</div>
                                                                </div>
                                                                {p.legal_notes && <div className="bg-blue-50 p-3 rounded-xl text-xs text-blue-900 italic border mb-4 text-left">"{p.legal_notes}"</div>}
                                                                <button onClick={() => openModal('property', p)} className="w-full py-3 bg-blue-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-black transition-all">Audit Jurídica</button>
                                                            </Card>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {/* PROPRIEDADES */}
                            {activeTab === 'properties' && (
                                <div className="space-y-8 animate-fade-in text-left">
                                    <div className="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-left">
                                        <h2 className="text-xl font-extrabold text-slate-800">Inventário Master</h2>
                                        <button onClick={() => openModal('property')} className="bg-blue-900 text-white px-6 py-3 rounded-xl text-sm font-extrabold flex items-center gap-2 shadow-lg"><Icon name="plus" weight="bold"/> NOVO IMÓVEL</button>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-left">
                                        {properties.map(p => (
                                            <Card key={p.id} className="overflow-hidden group card-hover border-none shadow-md text-left">
                                                <div className={`h-3 w-full ${p.status === 'Alugado' ? 'bg-blue-900' : (p.status === 'Vago' ? 'bg-red-500' : 'bg-yellow-500')}`}></div>
                                                <div className="p-6 text-left">
                                                    <h3 className="font-extrabold text-xl text-slate-800 mb-1 text-left">{p.nickname}</h3>
                                                    <p className="text-sm font-bold text-slate-500 mb-4 text-left">{p.address}</p>
                                                    <div className="flex justify-between items-center border-t border-slate-50 pt-4">
                                                        <span className="font-extrabold text-xl text-slate-800">{formatCurrency(p.base_rent)}</span>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => openModal('property', p)} className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg"><Icon name="pencil-simple" weight="bold"/></button>
                                                            <button onClick={() => deleteItem(p.id, properties, setProperties)} className="p-2 text-red-600 hover:bg-red-50 rounded-lg"><Icon name="trash" weight="bold"/></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </Card>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'tenants' && (
                                <div className="space-y-8 animate-fade-in text-left">
                                    <div className="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                                        <h2 className="text-xl font-extrabold text-slate-800 uppercase tracking-tighter text-left">Locatários</h2>
                                        <button onClick={() => openModal('tenant')} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl text-sm font-extrabold flex items-center gap-2 shadow-lg transition-all transform hover:-translate-y-1"><Icon name="plus" weight="bold"/> NOVO INQUILINO</button>
                                    </div>
                                    <Card className="p-0 overflow-hidden border-none shadow-md">
                                        <table className="w-full text-sm text-left font-bold text-left">
                                            <thead className="bg-slate-50 text-slate-400 uppercase font-extrabold text-[10px] border-b border-slate-100 text-left">
                                                <tr><th className="p-5">Nome</th><th className="p-5">CPF</th><th className="p-5 text-center">Documentos</th><th className="p-5 text-center">Status</th><th className="p-5 text-center">Ações</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50 text-left">
                                                {tenants.map(t => (
                                                    <tr key={t.id} className="hover:bg-slate-50 transition-colors text-slate-700 text-left text-left">
                                                        <td className="p-5">{t.name}</td>
                                                        <td className="p-5 font-mono">{t.cpf}</td>
                                                        <td className="p-5 text-center"><span className={`px-2 py-1 rounded text-[10px] font-bold uppercase ${t.documents_checked ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{t.documents_checked ? 'Verificados':'Pendentes'}</span></td>
                                                        <td className="p-5 text-center"><span className={`px-3 py-1 rounded-full text-[10px] uppercase font-extrabold ${t.status === 'Ativo' ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500'}`}>{t.status}</span></td>
                                                        <td className="p-5 flex justify-center gap-3">
                                                            <a href={`https://wa.me/${t.phone}`} target="_blank" className="p-2 text-green-600 hover:bg-green-50 rounded-lg"><Icon name="whatsapp-logo" weight="bold" size={20}/></a>
                                                            <button onClick={() => openModal('tenant', t)} className="text-blue-500 hover:text-blue-700 transition-colors"><Icon name="pencil-simple" weight="bold" size={20}/></button>
                                                            <button onClick={() => deleteItem(t.id, tenants, setTenants)} className="text-red-400 hover:text-red-600 transition-colors"><Icon name="trash" weight="bold" size={20}/></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </Card>
                                </div>
                            )}

                            {activeTab === 'contracts' && (
                                <div className="space-y-8 animate-fade-in text-left text-left">
                                    <div className="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-left text-left">
                                        <h2 className="text-xl font-extrabold text-slate-800 uppercase tracking-tighter">Gestão Documental</h2>
                                        <button onClick={() => openModal('contract')} className="bg-blue-900 hover:bg-black text-white px-6 py-3 rounded-xl text-sm font-extrabold flex items-center gap-2 shadow-lg transition-all transform hover:-translate-y-1"><Icon name="cloud-arrow-up" weight="bold"/> FAZER UPLOAD DO CONTRATO</button>
                                    </div>
                                    <div className="grid grid-cols-1 gap-4 text-left text-left">
                                        {contracts.map(c => {
                                            const prop = properties.find(p => p.id === c.propertyId);
                                            const tenant = tenants.find(t => t.id === c.tenantId);
                                            return (
                                                <Card key={c.id} className="p-6 flex flex-col md:flex-row justify-between items-center gap-6 border-l-8 border-l-blue-900 shadow-md text-left">
                                                    <div className="flex items-center gap-5 flex-1 text-left">
                                                        <div className="w-12 h-12 bg-blue-50 text-blue-900 rounded-xl flex items-center justify-center font-bold text-xl"><Icon name="file-pdf" weight="fill"/></div>
                                                        <div className="text-left text-left">
                                                            <h3 className="font-extrabold text-lg text-slate-800 uppercase tracking-tighter">{prop?.nickname || 'Ativo Excluído'}</h3>
                                                            <p className="text-sm font-bold text-slate-500">Locatário: {tenant?.name || 'Não identificado'}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-8 text-right text-left">
                                                        <div className="text-right text-left text-left"><p className="text-[10px] text-slate-400 uppercase font-extrabold tracking-widest">Aluguer</p><p className="text-2xl font-black text-slate-800">{formatCurrency(c.rent_value)}</p></div>
                                                        <div className="flex gap-2">
                                                            {c.fileName && <button onClick={() => showToast(`Download do ficheiro ${c.fileName}`, 'info')} className="p-3 bg-emerald-50 text-emerald-600 rounded-xl hover:bg-emerald-600 hover:text-white transition-all"><Icon name="download-simple" weight="bold"/></button>}
                                                            <button onClick={() => openModal('contract', c)} className="p-3 bg-slate-100 hover:bg-slate-200 rounded-xl text-slate-600 transition-colors"><Icon name="pencil-simple" weight="bold"/></button>
                                                        </div>
                                                    </div>
                                                </Card>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'finance' && (
                                <div className="space-y-8 animate-fade-in text-left">
                                    <div className="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-left">
                                        <h2 className="text-xl font-extrabold text-slate-800 uppercase tracking-tighter text-left">Tesouraria</h2>
                                        <button onClick={() => openModal('finance')} className="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-xl text-sm font-extrabold flex items-center gap-2 shadow-lg transition-all transform hover:-translate-y-1"><Icon name="plus" weight="bold"/> LANÇAMENTO</button>
                                    </div>
                                    <Card className="p-0 overflow-hidden border-none shadow-md text-left">
                                        <table className="w-full text-sm text-left font-bold text-left">
                                            <thead className="bg-slate-50 text-slate-400 uppercase font-extrabold text-[10px] border-b border-slate-100 text-left">
                                                <tr><th className="p-5">Data</th><th className="p-5">Descrição</th><th className="p-5 text-right">Valor</th><th className="p-5 text-center">Status</th><th className="p-5 text-center">Ações</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50 text-left">
                                                {financial.map(f => (
                                                    <tr key={f.id} className="hover:bg-slate-50 transition-colors text-slate-700 text-left text-left">
                                                        <td className="p-5">{new Date(f.date).toLocaleDateString()}</td>
                                                        <td className="p-5 uppercase tracking-tighter">{f.description}</td>
                                                        <td className={`p-5 text-right font-black ${f.type === 'Receita' ? 'text-green-600' : 'text-red-500'}`}>{f.type === 'Despesa' ? '-' : '+'} {formatCurrency(f.value)}</td>
                                                        <td className="p-5 text-center"><span className={`px-3 py-1 rounded-full text-[10px] uppercase font-extrabold ${f.status === 'Pago' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>{f.status}</span></td>
                                                        <td className="p-5 flex justify-center gap-3">
                                                            {f.type === 'Receita' && <button onClick={() => openModal('receipt', f)} className="text-slate-400 hover:text-blue-900"><Icon name="receipt" weight="bold" size={20}/></button>}
                                                            <button onClick={() => deleteItem(f.id, financial, setFinancial)} className="text-red-300 hover:text-red-500"><Icon name="trash" weight="bold" size={20}/></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </Card>
                                </div>
                            )}

                            {activeTab === 'reports' && (
                                <div className="space-y-8 animate-fade-in text-left text-left">
                                    <h2 className="text-xl font-extrabold text-slate-800 uppercase tracking-tighter">Relatórios Master</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-left text-center">
                                        <Card className="p-8 hover:shadow-lg transition-all cursor-pointer group border-b-4 border-b-blue-900 text-center" onClick={() => openModal('report_finance')}>
                                            <div className="p-4 bg-blue-50 text-blue-900 rounded-2xl group-hover:scale-110 transition-transform mx-auto w-fit text-center"><Icon name="currency-dollar" size={40} weight="duotone" /></div>
                                            <h3 className="font-extrabold text-xl text-slate-700 mt-4 uppercase text-center">Balanço</h3>
                                        </Card>
                                        <Card className="p-8 hover:shadow-lg transition-all cursor-pointer group border-b-4 border-b-green-900 text-center" onClick={() => openModal('report_occupancy')}>
                                            <div className="p-4 bg-green-50 text-green-900 rounded-2xl group-hover:scale-110 transition-transform mx-auto w-fit text-center"><Icon name="house-line" size={40} weight="duotone" /></div>
                                            <h3 className="font-extrabold text-xl text-slate-700 mt-4 uppercase text-center">Ocupação</h3>
                                        </Card>
                                        <Card className="p-8 hover:shadow-lg transition-all cursor-pointer group border-b-4 border-b-purple-900 text-center" onClick={() => openModal('report_tenants')}>
                                            <div className="p-4 bg-purple-50 text-purple-900 rounded-2xl group-hover:scale-110 transition-transform mx-auto w-fit text-center"><Icon name="users-three" size={40} weight="duotone" /></div>
                                            <h3 className="font-extrabold text-xl text-slate-700 mt-4 uppercase text-center">Inquilinos</h3>
                                        </Card>
                                    </div>
                                </div>
                            )}

                            {/* CONFIGURAÇÕES - RESTAURADA E DETALHADA */}
                            {activeTab === 'config' && (
                                <div className="space-y-8 animate-fade-in max-w-4xl mx-auto text-left">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">
                                        <Card className="p-8 shadow-lg border-t-8 border-t-blue-900 text-left">
                                            <h3 className="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 uppercase tracking-tighter text-left"><Icon name="user-circle" className="text-blue-900"/> Dados Mestre</h3>
                                            <form onSubmit={handleSaveConfig} className="space-y-5 text-left text-left">
                                                <div className="text-left text-left text-left text-left"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 text-left">Nome da Administração</label><input className="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 focus:bg-white focus:border-blue-900 outline-none font-bold text-slate-700" value={userData.name} onChange={e => setUserData({...userData, name: e.target.value})} /></div>
                                                <div className="text-left text-left text-left text-left"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 text-left">Email Principal</label><input type="email" className="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 focus:bg-white focus:border-blue-900 outline-none font-bold text-slate-700" value={userData.email} onChange={e => setUserData({...userData, email: e.target.value})} /></div>
                                                <button type="submit" className="w-full bg-blue-900 text-white font-black py-4 rounded-2xl transition-all shadow-xl shadow-blue-900/20 uppercase tracking-widest text-xs">Guardar Dados Master</button>
                                            </form>
                                        </Card>
                                        <Card className="p-8 shadow-lg border-t-8 border-t-red-600 text-left">
                                            <h3 className="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 uppercase tracking-tighter text-left"><Icon name="lock-key" className="text-red-600"/> Alterar Senha Master</h3>
                                            <form onSubmit={handleChangePassword} className="space-y-5 text-left text-left">
                                                <input type="password" required className="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 focus:bg-white focus:border-blue-900 outline-none font-bold text-slate-700" placeholder="Senha Atual" value={configPasswordForm.current} onChange={e => setConfigPasswordForm({...configPasswordForm, current: e.target.value})} />
                                                <input type="password" required className="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 focus:bg-white focus:border-blue-900 outline-none font-bold text-slate-700" placeholder="Nova Senha Master" value={configPasswordForm.newPass} onChange={e => setConfigPasswordForm({...configPasswordForm, newPass: e.target.value})} />
                                                <input type="password" required className="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 focus:bg-white focus:border-blue-900 outline-none font-bold text-slate-700" placeholder="Confirmar Nova Senha" value={configPasswordForm.confirm} onChange={e => setConfigPasswordForm({...configPasswordForm, confirm: e.target.value})} />
                                                <button type="submit" className="w-full bg-red-600 hover:bg-black text-white font-black py-4 rounded-2xl transition-all uppercase tracking-widest text-xs shadow-xl">Confirmar Nova Credencial</button>
                                            </form>
                                        </Card>
                                    </div>
                                </div>
                            )}

                        </div>
                    </main>

                    {/* MODAL UNIVERSAL */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-950/80 backdrop-blur-md z-50 flex items-center justify-center p-4 animate-fade-in print:p-0 print:bg-white text-left">
                            <div className={`bg-white rounded-[2.5rem] shadow-2xl w-full ${['contract_view', 'receipt', 'report_finance', 'report_occupancy', 'report_tenants'].includes(modalType) ? 'max-w-4xl' : 'max-w-md'} overflow-hidden relative print:shadow-none print:max-w-full print:rounded-none border-t-8 border-blue-900 text-left`}>
                                <div className="bg-white p-6 text-slate-800 flex justify-between items-center no-print border-b border-slate-100 text-left">
                                    <h3 className="font-extrabold text-xl uppercase tracking-tighter text-left">
                                        {modalType === 'property' && 'Ficha Jurídica do Ativo'}
                                        {modalType === 'tenant' && 'Ficha de Locatário'}
                                        {modalType === 'contract' && 'Fazer Upload de Contrato'}
                                        {modalType === 'finance' && 'Tesouraria Master'}
                                        {modalType === 'receipt' && 'Recibo de Quitação'}
                                        {modalType.startsWith('report_') && 'Painel Master de Auditoria'}
                                    </h3>
                                    <button onClick={() => setIsModalOpen(false)} className="bg-slate-100 p-2 rounded-xl text-slate-400 hover:text-red-500 transition-colors"><Icon name="x" weight="bold" size={24}/></button>
                                </div>

                                {modalType === 'contract_view' && editingItem ? (
                                    <div className="p-12 print-area text-left" id="print-area-container">
                                        <div className="text-center mb-10 pb-6 border-b-2 border-black">
                                            <h1 className="font-black text-2xl uppercase text-blue-900">GESTÃO MASTER - DOCUMENTAÇÃO</h1>
                                        </div>
                                        <div className="contract-body text-base space-y-6 text-left">
                                            <p><strong>DAS PARTES:</strong> Locação regida pela Administração Mestre GESTÃO MASTER entre o Locador e o Locatário <strong>{tenants.find(t=>t.id===editingItem.tenantId)?.name}</strong>.</p>
                                            <p><strong>REAJUSTE:</strong> O valor mensal de <strong>{formatCurrency(editingItem.rent_value)}</strong> será reajustado em conformidade com o índice pactuado.</p>
                                            <br/><br/><br/><br/>
                                            <div className="flex justify-between text-center gap-10">
                                                <div className="w-1/2 border-t border-black pt-2 font-black uppercase text-[10px]">Administração Master</div>
                                                <div className="w-1/2 border-t border-black pt-2 font-black uppercase text-[10px]">Assinatura Locatário</div>
                                            </div>
                                        </div>
                                        <button onClick={() => window.print()} className="mt-10 w-full p-4 bg-blue-900 text-white font-black rounded-2xl no-print uppercase tracking-widest text-xs">Imprimir Instrumento</button>
                                    </div>
                                ) : modalType === 'receipt' && editingItem ? (
                                    <div className="p-10 print-area text-left text-left" id="print-area-container">
                                        <div className="recibo-box text-left">
                                            <h1 className="text-center font-black text-3xl mb-8 text-blue-900 uppercase">Recibo Master</h1>
                                            <p className="text-xl">Recebemos a quantia de <strong className="bg-slate-100 px-2 rounded-lg">{formatCurrency(editingItem.value)}</strong> referente à liquidação Master.</p>
                                            <br/><br/>
                                            <p className="text-right font-bold text-slate-400">Data de Emissão: {new Date().toLocaleDateString()}</p>
                                        </div>
                                        <div className="mt-8 flex justify-center no-print text-left">
                                            <button type="button" onClick={() => window.print()} className="px-10 py-4 bg-blue-900 text-white font-black rounded-2xl hover:bg-black uppercase tracking-widest text-xs"><Icon name="printer" weight="bold" className="mr-2"/> Imprimir Recibo</button>
                                        </div>
                                    </div>
                                ) : modalType.startsWith('report_') ? (
                                    <div className="p-8 print-area text-left" id="print-area-container">
                                        <div className="text-center mb-10 pb-6 border-b-2 border-blue-900">
                                            <h1 className="font-black text-3xl uppercase text-blue-900">GESTÃO MASTER</h1>
                                            <p className="font-bold text-slate-400 tracking-widest uppercase text-xs mt-1">Relatório Oficial</p>
                                            <p className="text-xs text-slate-400 mt-2 font-bold uppercase tracking-widest">Emissão: {new Date().toLocaleDateString()}</p>
                                        </div>
                                        <table className="print-table text-left">
                                            <thead>
                                                <tr>
                                                    {modalType === 'report_finance' && <><th className="p-4">Data</th><th className="p-4">Descrição</th><th className="p-4">Valor</th></>}
                                                    {modalType === 'report_occupancy' && <><th className="p-4">Imóvel</th><th className="p-4">Status</th><th className="p-4">Jurídico</th></>}
                                                    {modalType === 'report_tenants' && <><th className="p-4">Nome</th><th className="p-4">Documentos</th><th className="p-4">Telefone</th></>}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {modalType === 'report_finance' && financial.map(f=>(<tr key={f.id}><td>{f.date}</td><td>{f.description}</td><td>{formatCurrency(f.value)}</td></tr>))}
                                                {modalType === 'report_occupancy' && properties.map(p=>(<tr key={p.id}><td>{p.nickname}</td><td>{p.status}</td><td>{p.legal_status}</td></tr>))}
                                                {modalType === 'report_tenants' && tenants.map(t=>(<tr key={t.id}><td>{t.name}</td><td>{t.documents_checked ? 'Completo':'Pendente'}</td><td>{t.phone}</td></tr>))}
                                            </tbody>
                                        </table>
                                        <div className="mt-10 flex justify-end gap-3 no-print">
                                            <button type="button" onClick={() => generateReportCSV(modalType.replace('report_', ''))} className="px-5 py-3 bg-blue-100 text-blue-900 font-extrabold rounded-xl hover:bg-blue-200 flex items-center gap-2"><Icon name="file-csv" weight="bold"/> Exportar CSV</button>
                                            <button type="button" onClick={() => window.print()} className="px-5 py-3 bg-blue-900 text-white font-extrabold rounded-xl hover:bg-black flex items-center gap-2 shadow-lg"><Icon name="printer" weight="bold"/> Imprimir PDF</button>
                                            <button type="button" onClick={() => setIsModalOpen(false)} className="px-5 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl">Fechar</button>
                                        </div>
                                    </div>
                                ) : (
                                    <form onSubmit={saveItem} className="p-8 space-y-6 max-h-[75vh] overflow-y-auto text-left font-bold text-slate-700">
                                        {modalType === 'property' && (
                                            <>
                                                <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">Identificação Ativo</label><input required className="w-full p-4 border-2 border-slate-50 rounded-2xl outline-none focus:border-blue-900 transition-all font-bold" value={propertyForm.nickname} onChange={e => setPropertyForm({...propertyForm, nickname: e.target.value})} placeholder="Ex: Casa Jardim"/></div>
                                                <div className="flex gap-4">
                                                    <div className="flex-1">
                                                        <label className="text-[10px] font-black text-slate-400 uppercase block mb-1 tracking-widest">Estatuto Jurídico Master</label>
                                                        <select className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={propertyForm.legal_status} onChange={e => setPropertyForm({...propertyForm, legal_status: e.target.value})}>
                                                            <option>Regular</option><option>Espólio</option><option>Inventário em Trâmite</option><option>Nome de Parente</option><option>Usucapião</option><option>Contrato de Gaveta</option><option>Financiado</option><option>Judicial</option><option>Pendente Habite-se</option><option>Dívida Ativa / Penhora</option>
                                                        </select>
                                                    </div>
                                                    <div className="flex-1">
                                                        <label className="text-[10px] font-black text-slate-400 uppercase block mb-1 tracking-widest">Tipologia</label>
                                                        <select className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={propertyForm.type} onChange={e => setPropertyForm({...propertyForm, type: e.target.value})}>
                                                            <option>Casa</option><option>Apartamento</option><option>Comercial</option></select>
                                                    </div>
                                                </div>
                                                <div className="bg-blue-50/50 p-6 rounded-3xl border-2 border-blue-100/50 text-left">
                                                    <h4 className="text-[10px] font-black text-blue-900 uppercase tracking-widest mb-4 text-left">Certificação de Documentos</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 text-left">
                                                        <label className="flex items-center gap-2 cursor-pointer text-left"><input type="checkbox" className="w-5 h-5" checked={propertyForm.doc_registration} onChange={e=>setPropertyForm({...propertyForm, doc_registration:e.target.checked})} /><span className="text-[10px] uppercase">Matrícula</span></label>
                                                        <label className="flex items-center gap-2 cursor-pointer text-left"><input type="checkbox" className="w-5 h-5" checked={propertyForm.doc_deed} onChange={e=>setPropertyForm({...propertyForm, doc_deed:e.target.checked})} /><span className="text-[10px] uppercase">Escritura</span></label>
                                                        <label className="flex items-center gap-2 cursor-pointer text-left"><input type="checkbox" className="w-5 h-5" checked={propertyForm.doc_iptu} onChange={e=>setPropertyForm({...propertyForm, doc_iptu:e.target.checked})} /><span className="text-[10px] uppercase">IPTU Pago</span></label>
                                                    </div>
                                                    <textarea className="w-full p-4 border-2 border-white rounded-2xl focus:border-blue-900 transition-all font-bold h-24 text-xs italic" value={propertyForm.legal_notes} onChange={e => setPropertyForm({...propertyForm, legal_notes: e.target.value})} placeholder="Registe aqui as notas jurídicas master, processos e herdeiros..."></textarea>
                                                </div>
                                                <input type="number" className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={propertyForm.base_rent} onChange={e => setPropertyForm({...propertyForm, base_rent: e.target.value})} placeholder="Avaliação Mestre (R$)" />
                                            </>
                                        )}

                                        {modalType === 'tenant' && (
                                            <>
                                                <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">Nome Completo</label><input required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={tenantForm.name} onChange={e => setTenantForm({...tenantForm, name: e.target.value})} /></div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">CPF/NIF</label><input required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={tenantForm.cpf} onChange={e => setTenantForm({...tenantForm, cpf: e.target.value})} /></div>
                                                    <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">WhatsApp</label><input required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={tenantForm.phone} onChange={e => setTenantForm({...tenantForm, phone: e.target.value})} /></div>
                                                </div>
                                                <div className="flex items-center gap-3 bg-slate-50 p-4 rounded-2xl border">
                                                    <input type="checkbox" className="w-5 h-5 text-blue-900 border-2 rounded-lg" checked={tenantForm.documents_checked} onChange={e => setTenantForm({...tenantForm, documents_checked: e.target.checked})} /><label className="text-xs font-black uppercase text-slate-500 tracking-widest">Docs Verificados</label>
                                                </div>
                                            </>
                                        )}

                                        {modalType === 'contract' && (
                                            <>
                                                <div className="flex gap-4 text-left">
                                                    <div className="flex-1 text-left"><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">Vincular Ativo</label><select required className="w-full p-4 border-2 border-slate-100 rounded-2xl font-bold" value={contractForm.propertyId} onChange={e => setContractForm({...contractForm, propertyId: e.target.value})}><option value="">Selecionar Ativo...</option>{properties.filter(p=>p.status==='Vago' || p.id === editingItem?.propertyId).map(p=><option key={p.id} value={p.id}>{p.nickname}</option>)}</select></div>
                                                    <div className="flex-1 text-left"><label className="text-[10px] font-black text-slate-400 uppercase block mb-1">Locatário</label><select required className="w-full p-4 border-2 border-slate-100 rounded-2xl font-bold" value={contractForm.tenantId} onChange={e => setContractForm({...contractForm, tenantId: e.target.value})}><option value="">Selecionar Locatário...</option>{tenants.map(t=><option key={t.id} value={t.id}>{t.name}</option>)}</select></div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-4 text-left text-left">
                                                    <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1 text-left">Renda Mensal (R$)</label><input type="number" required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={contractForm.rent_value} onChange={e => setContractForm({...contractForm, rent_value: e.target.value})} /></div>
                                                    <div><label className="text-[10px] font-black text-slate-400 uppercase block mb-1 text-left">Dia Pagamento</label><input type="number" required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" value={contractForm.payment_day} onChange={e => setContractForm({...contractForm, payment_day: e.target.value})} /></div>
                                                </div>
                                                <div className="p-10 border-2 border-dashed border-blue-900/20 rounded-[2rem] bg-blue-50/30 text-center relative overflow-hidden group hover:bg-blue-900 transition-all cursor-pointer text-center">
                                                    <Icon name="cloud-arrow-up" size={48} className="mx-auto mb-3 text-blue-900 group-hover:text-white transition-colors" />
                                                    <p className="text-xs font-black uppercase text-blue-900 group-hover:text-white transition-colors tracking-widest">{contractForm.fileName || "Anexar Digitalização Master"}</p>
                                                    <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e=>setContractForm({...contractForm, fileName: e.target.files[0]?.name || ''})} />
                                                </div>
                                            </>
                                        )}

                                        {modalType === 'finance' && (
                                            <>
                                                <div className="grid grid-cols-2 gap-4 text-left">
                                                    <div className="text-left"><label className="text-[10px] font-black text-slate-400 uppercase block mb-1 text-left">Modalidade</label><select className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold text-left" value={financeForm.type} onChange={e => setFinanceForm({...financeForm, type: e.target.value})}><option value="Receita">Receita (+)</option><option value="Despesa">Despesa (-)</option></select></div>
                                                    <div className="text-left"><label className="text-[10px] font-black text-slate-400 uppercase block mb-1 text-left">Data Liquidação</label><input type="date" className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold text-left" value={financeForm.date} onChange={e => setFinanceForm({...financeForm, date: e.target.value})} /></div>
                                                </div>
                                                <input required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" placeholder="Descrição Master" value={financeForm.description} onChange={e => setFinanceForm({...financeForm, description: e.target.value})} />
                                                <input type="number" required className="w-full p-4 border-2 border-slate-50 rounded-2xl font-bold" placeholder="Valor Transacionado" value={financeForm.value} onChange={e => setFinanceForm({...financeForm, value: e.target.value})} />
                                            </>
                                        )}

                                        <div className="pt-6 flex justify-end gap-3 border-t text-left">
                                            <button type="button" onClick={() => setIsModalOpen(false)} className="px-6 py-4 text-slate-400 font-bold hover:bg-slate-50 rounded-2xl text-[10px] uppercase tracking-widest transition-all">Sair</button>
                                            <button type="submit" className="px-10 py-4 bg-blue-900 text-white font-black rounded-2xl shadow-xl flex items-center gap-2 transform hover:-translate-y-1 transition-all text-[10px] uppercase tracking-widest"><Icon name="check" weight="bold"/> Confirmar Registo</button>
                                        </div>
                                    </form>
                                )}
                            </div>
                        </div>
                    )}
                    
                    <footer className="mt-12 py-6 text-center text-xs text-slate-400 border-t border-slate-100">
                        <p>© 2026 SoftGestão. Todos os direitos reservados.</p>
                        <p className="mt-1">Propriedade e Marca Registada de <span className="font-bold text-slate-600">Adriana Mendes da Cruz Sousa</span>.</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
